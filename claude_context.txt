File: backend/src/db/models/school.py
from datetime import datetime
from typing import List, Optional, Dict, Any
from sqlmodel import Field, SQLModel, Relationship, JSON


class School(SQLModel, table=True):
    """Model for schools integrating with the platform."""

    id: Optional[int] = Field(default=None, primary_key=True)
    name: str = Field(index=True)
    code: str = Field(index=True, unique=True)  # Unique identifier for the school

    # School details
    address: str
    city: str
    region: str = Field(index=True)
    school_type: str = Field(index=True)  # public, private, mission, international
    education_levels: List[str] = Field(
        default=[], sa_type=JSON
    )  # primary, college, lycee, university

    # Contact information
    contact_email: str
    contact_phone: str
    website: Optional[str] = None

    # Administrative details
    admin_user_id: Optional[int] = Field(default=None, foreign_key="users.id")
    is_active: bool = True
    subscription_type: str = "basic"  # basic, premium, enterprise
    subscription_expires: Optional[datetime] = None

    # Branding
    logo_url: Optional[str] = None
    color_scheme: Optional[str] = None

    # Integration settings
    integration_settings: Dict[str, Any] = Field(default={}, sa_type=JSON)
    api_key: Optional[str] = None

    # Timestamps
    created_at: datetime = Field(default_factory=datetime.utcnow)
    updated_at: Optional[datetime] = None

    # Relationships
    departments: List["Department"] = Relationship(back_populates="school")
    school_classes: List["SchoolClass"] = Relationship(back_populates="school")
    staff_members: List["SchoolStaff"] = Relationship(back_populates="school")
    school_courses: List["SchoolCourse"] = Relationship(back_populates="school")
    students: List["SchoolStudent"] = Relationship(back_populates="school")


class Department(SQLModel, table=True):
    """Model for academic departments within a school."""

    id: Optional[int] = Field(default=None, primary_key=True)
    school_id: int = Field(foreign_key="school.id", index=True)
    name: str
    code: str = Field(index=True)  # Department code

    # Department details
    description: Optional[str] = None
    education_level: Optional[str] = None  # primary, college, lycee, university

    # Administrative details
    head_staff_id: Optional[int] = Field(default=None, foreign_key="schoolstaff.id")

    # Timestamps
    created_at: datetime = Field(default_factory=datetime.utcnow)
    updated_at: Optional[datetime] = None

    # Relationships
    school: School = Relationship(back_populates="departments")
    courses: List["SchoolCourse"] = Relationship(back_populates="department")
    staff_members: List["DepartmentStaffAssignment"] = Relationship(
        back_populates="department"
    )


class SchoolClass(SQLModel, table=True):
    """Model for classes/sections within a school."""

    id: Optional[int] = Field(default=None, primary_key=True)
    school_id: int = Field(foreign_key="school.id", index=True)
    name: str  # e.g., "Class 10A", "Section B"

    # Class details
    academic_year: str = Field(index=True)  # e.g., "2024-2025"
    education_level: str = Field(index=True)  # primary_1, bac_2, etc.
    academic_track: Optional[str] = Field(
        default=None, index=True
    )  # sciences_math_a, etc.

    # Class information
    room_number: Optional[str] = None
    capacity: Optional[int] = None

    # Administrative details
    homeroom_teacher_id: Optional[int] = Field(
        default=None, foreign_key="schoolstaff.id"
    )

    # Timestamps
    created_at: datetime = Field(default_factory=datetime.utcnow)
    updated_at: Optional[datetime] = None

    # Relationships
    school: School = Relationship(back_populates="school_classes")
    students: List["ClassEnrollment"] = Relationship(back_populates="school_class")
    class_schedules: List["ClassSchedule"] = Relationship(back_populates="school_class")


class SchoolStaff(SQLModel, table=True):
    """Model for staff members (teachers, administrators) at a school."""

    id: Optional[int] = Field(default=None, primary_key=True)
    user_id: int = Field(foreign_key="users.id", index=True)
    school_id: int = Field(foreign_key="school.id", index=True)

    # Staff details
    staff_type: str = Field(index=True)  # teacher, admin, counselor, principal
    employee_id: Optional[str] = None

    # Teacher-specific fields
    is_teacher: bool = Field(default=False, index=True)
    qualifications: List[str] = Field(default=[], sa_type=JSON)
    expertise_subjects: List[str] = Field(default=[], sa_type=JSON)

    # Administrative
    hire_date: Optional[datetime] = None
    is_active: bool = True

    # Contact details
    work_email: Optional[str] = None
    work_phone: Optional[str] = None

    # Timestamps
    created_at: datetime = Field(default_factory=datetime.utcnow)
    updated_at: Optional[datetime] = None

    # Relationships
    user: "User" = Relationship()  # Link to main user account # noqa: F821
    school: School = Relationship(back_populates="staff_members")
    department_assignments: List["DepartmentStaffAssignment"] = Relationship(
        back_populates="staff_member"
    )
    taught_courses: List["SchoolCourse"] = Relationship(back_populates="teacher")
    class_schedules: List["ClassSchedule"] = Relationship(back_populates="teacher")


class DepartmentStaffAssignment(SQLModel, table=True):
    """Model for assigning staff to departments."""

    id: Optional[int] = Field(default=None, primary_key=True)
    department_id: int = Field(foreign_key="department.id", index=True)
    staff_id: int = Field(foreign_key="schoolstaff.id", index=True)

    # Assignment details
    role: str  # member, coordinator, head
    is_primary: bool = False

    # Timestamps
    assigned_at: datetime = Field(default_factory=datetime.utcnow)
    updated_at: Optional[datetime] = None

    # Relationships
    department: Department = Relationship(back_populates="staff_members")
    staff_member: SchoolStaff = Relationship(back_populates="department_assignments")


class SchoolCourse(SQLModel, table=True):
    """Enhanced model for school courses with AI tutoring integration."""

    id: Optional[int] = Field(default=None, primary_key=True)
    school_id: int = Field(foreign_key="school.id", index=True)
    department_id: Optional[int] = Field(
        default=None, foreign_key="department.id", index=True
    )
    platform_course_id: Optional[int] = Field(default=None, foreign_key="course.id")
    teacher_id: Optional[int] = Field(default=None, foreign_key="schoolstaff.id")

    # Course details
    title: str
    code: str  # School's course code
    description: str

    # Academic information
    academic_year: str = Field(index=True)
    education_level: str = Field(index=True)
    academic_track: Optional[str] = Field(default=None, index=True)
    credits: Optional[float] = None

    # Course Structure
    syllabus: Dict[str, Any] = Field(default={}, sa_type=JSON)
    learning_objectives: List[str] = Field(default=[], sa_type=JSON)
    prerequisites: List[str] = Field(default=[], sa_type=JSON)

    # AI Tutoring Integration
    ai_tutoring_enabled: bool = True
    ai_tutoring_config: Dict[str, Any] = Field(default={}, sa_type=JSON)
    suggested_topics: List[str] = Field(default=[], sa_type=JSON)

    # Course Materials
    required_materials: Dict[str, Any] = Field(default={}, sa_type=JSON)
    supplementary_resources: Dict[str, Any] = Field(default={}, sa_type=JSON)

    # Assessment Configuration
    grading_schema: Dict[str, Any] = Field(default={}, sa_type=JSON)
    assessment_types: List[str] = Field(default=[], sa_type=JSON)

    # Collaboration Settings
    allow_group_work: bool = True
    peer_review_enabled: bool = False
    discussion_enabled: bool = True

    # Status and Schedule
    status: str = "active"  # draft, active, archived
    start_date: Optional[datetime] = None
    end_date: Optional[datetime] = None

    # Timestamps
    created_at: datetime = Field(default_factory=datetime.utcnow)
    updated_at: Optional[datetime] = None

    # Relationships
    teacher: Optional["SchoolStaff"] = Relationship(back_populates="taught_courses")  # noqa: F821
    school: "School" = Relationship(back_populates="school_courses")  # noqa: F821
    department: Optional["Department"] = Relationship(back_populates="courses")  # noqa: F821
    platform_course: Optional["Course"] = Relationship()  # noqa: F821
    professors: List["ProfessorCourse"] = Relationship(back_populates="course")  # noqa: F821
    class_schedules: List["ClassSchedule"] = Relationship(back_populates="course")  # noqa: F821
    course_enrollments: List["CourseEnrollment"] = Relationship(back_populates="course")  # noqa: F821
    assignments: List["Assignment"] = Relationship(back_populates="course")  # noqa: F821
    materials: List["CourseMaterial"] = Relationship(back_populates="course")  # noqa: F821
    tutoring_sessions: List["CourseAITutoringSession"] = Relationship(  # noqa: F821
        back_populates="course"
    )


class SchoolStudent(SQLModel, table=True):
    """Model for students enrolled in a school."""

    id: Optional[int] = Field(default=None, primary_key=True)
    user_id: int = Field(foreign_key="users.id", index=True)
    school_id: int = Field(foreign_key="school.id", index=True)

    # Student details
    student_id: str  # School's ID for the student
    enrollment_date: datetime

    # Academic information
    education_level: str = Field(index=True)  # primary_1, bac_2, etc.
    academic_track: Optional[str] = Field(default=None, index=True)

    # Status
    is_active: bool = True
    graduation_year: Optional[str] = None

    # Timestamps
    created_at: datetime = Field(default_factory=datetime.utcnow)
    updated_at: Optional[datetime] = None

    # Relationships
    user: "User" = Relationship()  # Link to main user account # noqa: F821
    school: School = Relationship(back_populates="students")
    class_enrollments: List["ClassEnrollment"] = Relationship(back_populates="student")
    course_enrollments: List["CourseEnrollment"] = Relationship(
        back_populates="student"
    )
    assignment_submissions: List["AssignmentSubmission"] = Relationship(
        back_populates="student"
    )


class ClassEnrollment(SQLModel, table=True):
    """Model for student enrollment in classes."""

    id: Optional[int] = Field(default=None, primary_key=True)
    student_id: int = Field(foreign_key="schoolstudent.id", index=True)
    class_id: int = Field(foreign_key="schoolclass.id", index=True)

    # Enrollment details
    academic_year: str = Field(index=True)  # e.g., "2024-2025"
    enrollment_date: datetime = Field(default_factory=datetime.utcnow)

    # Status
    status: str = "active"  # active, inactive, transferred, graduated

    # Timestamps
    created_at: datetime = Field(default_factory=datetime.utcnow)
    updated_at: Optional[datetime] = None

    # Relationships
    student: SchoolStudent = Relationship(back_populates="class_enrollments")
    school_class: SchoolClass = Relationship(back_populates="students")


class CourseEnrollment(SQLModel, table=True):
    """Model for student enrollment in school courses."""

    id: Optional[int] = Field(default=None, primary_key=True)
    student_id: int = Field(foreign_key="schoolstudent.id", index=True)
    course_id: int = Field(foreign_key="schoolcourse.id", index=True)

    # Enrollment details
    academic_year: str = Field(index=True)  # e.g., "2024-2025"
    enrollment_date: datetime = Field(default_factory=datetime.utcnow)

    # Performance tracking
    grade: Optional[float] = None
    grade_letter: Optional[str] = None
    attendance_percentage: Optional[float] = None

    # Status
    status: str = "enrolled"  # enrolled, completed, dropped, failed
    completion_date: Optional[datetime] = None

    # Timestamps
    created_at: datetime = Field(default_factory=datetime.utcnow)
    updated_at: Optional[datetime] = None

    # Relationships
    student: SchoolStudent = Relationship(back_populates="course_enrollments")
    course: SchoolCourse = Relationship(back_populates="course_enrollments")


class ClassSchedule(SQLModel, table=True):
    """Enhanced model for class schedules and timetables."""

    id: Optional[int] = Field(default=None, primary_key=True)
    class_id: int = Field(foreign_key="schoolclass.id", index=True)
    course_id: int = Field(foreign_key="schoolcourse.id", index=True)
    teacher_id: int = Field(foreign_key="schoolstaff.id", index=True)

    # Schedule details
    title: str  # Added title field for better description
    description: Optional[str] = None  # Added description
    day_of_week: int  # 0-6 (Monday-Sunday)
    start_time: str  # HH:MM format
    end_time: str  # HH:MM format
    room: Optional[str] = None

    # Add a specific color for visual representation
    color: Optional[str] = None

    # Recurring pattern
    recurrence_pattern: str = "weekly"  # weekly, biweekly, once
    start_date: datetime
    end_date: Optional[datetime] = None

    # Status
    is_active: bool = True
    is_cancelled: bool = False  # Add cancelled status for one-off cancellations

    # Timestamps
    created_at: datetime = Field(default_factory=datetime.utcnow)
    updated_at: Optional[datetime] = None

    # Relationships
    school_class: SchoolClass = Relationship(back_populates="class_schedules")
    course: SchoolCourse = Relationship(back_populates="class_schedules")
    teacher: SchoolStaff = Relationship(back_populates="class_schedules")


class Assignment(SQLModel, table=True):
    """Model for assignments given to students."""

    id: Optional[int] = Field(default=None, primary_key=True)
    course_id: int = Field(foreign_key="schoolcourse.id", index=True)
    professor_id: Optional[int] = Field(default=None, foreign_key="schoolprofessor.id")

    # Assignment details
    title: str
    description: str
    assignment_type: str  # homework, project, quiz, exam

    # Timeframe
    assigned_date: datetime = Field(default_factory=datetime.utcnow)
    due_date: datetime

    # Grading
    points_possible: float
    grading_criteria: Dict[str, Any] = Field(default={}, sa_type=JSON)

    # Content
    instructions: str
    materials: Dict[str, Any] = Field(default={}, sa_type=JSON)
    resources: Dict[str, Any] = Field(default={}, sa_type=JSON)

    # Status
    is_published: bool = True

    # Timestamps
    created_at: datetime = Field(default_factory=datetime.utcnow)
    updated_at: Optional[datetime] = None

    # Relationships
    course: "SchoolCourse" = Relationship(back_populates="assignments")  # noqa: F821
    submissions: List["AssignmentSubmission"] = Relationship(
        back_populates="assignment"
    )  # noqa: F821
    professor: Optional["SchoolProfessor"] = Relationship(back_populates="assignments")  # noqa: F821


class AssignmentSubmission(SQLModel, table=True):
    """Model for student submissions to assignments."""

    id: Optional[int] = Field(default=None, primary_key=True)
    assignment_id: int = Field(foreign_key="assignment.id", index=True)
    student_id: int = Field(foreign_key="schoolstudent.id", index=True)

    # Submission details
    submission_date: datetime = Field(default_factory=datetime.utcnow)
    content: Dict[str, Any] = Field(
        sa_type=JSON
    )  # Flexible storage for various submission types

    # Status
    status: str = "submitted"  # draft, submitted, graded, returned

    # Grading
    grade: Optional[float] = None
    feedback: Optional[str] = None
    graded_by: Optional[int] = Field(default=None, foreign_key="schoolstaff.id")
    graded_at: Optional[datetime] = None

    # Timestamps
    created_at: datetime = Field(default_factory=datetime.utcnow)
    updated_at: Optional[datetime] = None

    # Relationships
    assignment: Assignment = Relationship(back_populates="submissions")
    student: SchoolStudent = Relationship(back_populates="assignment_submissions")


# Additional models to enhance school integration


class LessonPlan(SQLModel, table=True):
    """Model for teacher lesson plans."""

    id: Optional[int] = Field(default=None, primary_key=True)
    course_id: int = Field(foreign_key="schoolcourse.id", index=True)
    teacher_id: int = Field(foreign_key="schoolstaff.id", index=True)

    # Lesson details
    title: str
    description: str
    objectives: List[str] = Field(default=[], sa_type=JSON)

    # Content
    content: Dict[str, Any] = Field(default={}, sa_type=JSON)
    resources: Dict[str, Any] = Field(default={}, sa_type=JSON)

    # Scheduling
    planned_date: Optional[datetime] = None
    duration_minutes: int

    # Status
    status: str = "draft"  # draft, ready, delivered, archived

    # AI integration
    ai_enhanced: bool = False
    ai_contributions: Dict[str, Any] = Field(default={}, sa_type=JSON)

    # Timestamps
    created_at: datetime = Field(default_factory=datetime.utcnow)
    updated_at: Optional[datetime] = None


class AttendanceRecord(SQLModel, table=True):
    """Model for tracking student attendance."""

    id: Optional[int] = Field(default=None, primary_key=True)
    class_id: int = Field(foreign_key="schoolclass.id", index=True)
    student_id: int = Field(foreign_key="schoolstudent.id", index=True)

    # Attendance details
    date: datetime = Field(index=True)
    status: str  # present, absent, late, excused

    # Additional information
    notes: Optional[str] = None
    recorded_by: Optional[int] = Field(default=None, foreign_key="schoolstaff.id")

    # Timestamps
    created_at: datetime = Field(default_factory=datetime.utcnow)
    updated_at: Optional[datetime] = None


class SchoolAnnouncement(SQLModel, table=True):
    """Model for school-wide or department-specific announcements."""

    id: Optional[int] = Field(default=None, primary_key=True)
    school_id: int = Field(foreign_key="school.id", index=True)
    department_id: Optional[int] = Field(default=None, foreign_key="department.id")

    # Announcement details
    title: str
    content: str

    # Publishing details
    published_by: int = Field(foreign_key="schoolstaff.id")
    published_at: datetime = Field(default_factory=datetime.utcnow)

    # Target audience
    audience_type: str  # all, staff, students, parents, department
    target_classes: List[int] = Field(default=[], sa_type=JSON)

    # Display settings
    priority: str = "normal"  # low, normal, high, urgent
    expires_at: Optional[datetime] = None

    # Status
    is_published: bool = True

    # Timestamps
    created_at: datetime = Field(default_factory=datetime.utcnow)
    updated_at: Optional[datetime] = None


File: backend/src/db/models/user.py
from sqlmodel import SQLModel, Field
from datetime import datetime
from typing import Optional, Dict, Any, List
from sqlmodel import JSON
from sqlmodel import Relationship


class User(SQLModel, table=True):
    """Enhanced User database model with improved avatar support"""

    __tablename__ = "users"

    id: int = Field(default=None, primary_key=True)

    # Basic info
    email: str = Field(..., index=True, unique=True)
    username: str = Field(..., index=True, unique=True)
    full_name: str
    hashed_password: str

    # Enhanced Avatar support
    avatar: Optional[str] = None  # URL to avatar image
    avatar_metadata: Dict[str, Any] = Field(
        default={}, sa_type=JSON
    )  # Stores metadata about the avatar
    avatar_updated_at: Optional[datetime] = None  # When the avatar was last updated

    # Profile data
    locale: str = "ar"  # Default to Arabic, options: ar, fr, en
    bio: Optional[str] = None  # User biography/about me

    # User type and detailed education info
    user_type: str = Field(..., index=True)  # student, teacher, parent, school_admin

    # Education level mapping from onboarding
    education_level: Optional[str] = Field(default=None, index=True)
    # Options: primary_1 through primary_6, college_7 through college_9,
    # tronc_commun, bac_1, bac_2, university

    # School information
    school_type: Optional[str] = Field(default=None, index=True)
    # Options: public, private, mission, international, homeschool
    school_name: Optional[str] = None
    region: Optional[str] = Field(default=None, index=True)
    # Options: casablanca-settat, rabat-sale-kenitra, marrakech-safi, etc.

    # Academic track (filière)
    academic_track: Optional[str] = Field(default=None, index=True)
    # For high school: sciences_math_a, svt_pc, etc.
    # For university: uni_fst, uni_medicine, etc.

    # Learning preferences
    learning_style: Optional[str] = Field(default=None)
    # Options: visual, auditory, reading, kinesthetic
    study_habits: List[str] = Field(default=[], sa_type=JSON)
    # Options: morning, evening, concentrated, spaced, group, individual
    academic_goals: List[str] = Field(default=[], sa_type=JSON)
    # Options: academic-excellence, bac-preparation, etc.

    # Account status
    is_active: bool = Field(default=True)
    is_verified: bool = Field(default=False)
    has_onboarded: bool = Field(default=False)

    # Security and tracking fields
    failed_login_attempts: int = Field(default=0)
    last_login_attempt: Optional[datetime] = None
    last_login: Optional[datetime] = None
    token_revoked_at: Optional[datetime] = None

    # Account creation and updates
    created_at: datetime = Field(default_factory=datetime.utcnow)
    updated_at: Optional[datetime] = None

    # Password reset tracking
    reset_token: Optional[str] = None
    reset_token_expires: Optional[datetime] = None

    # User settings and preferences
    settings: Dict[str, Any] = Field(default={}, sa_type=JSON)

    # Privacy and data preferences
    data_consent: bool = Field(default=False)

    # Relationships
    schedule_entries: List["ScheduleEntry"] = Relationship(back_populates="user")  # noqa: F821
    guardians: List["Guardian"] = Relationship(
        back_populates="student",
        sa_relationship_kwargs={"foreign_keys": "[Guardian.student_id]"},
    )
    supervised_students: List["Guardian"] = Relationship(
        back_populates="parent",
        sa_relationship_kwargs={"foreign_keys": "[Guardian.parent_id]"},
    )
    enrollments: List["Enrollment"] = Relationship(back_populates="user")  # noqa: F821
    activities: List["Activity"] = Relationship(back_populates="user")  # noqa: F821
    tutoring_sessions: List["TutoringSession"] = Relationship(back_populates="user")  # noqa: F821
    detailed_tutoring_sessions: List["DetailedTutoringSession"] = Relationship(  # noqa: F821
        back_populates="user"
    )
    recommendations: List["Recommendation"] = Relationship(back_populates="user")  # noqa: F821
    achievements: List["Achievement"] = Relationship(back_populates="user")  # noqa: F821
    notifications: List["Notification"] = Relationship(back_populates="user")  # noqa: F821
    messages: List["Message"] = Relationship(  # noqa: F821
        back_populates="user",
        sa_relationship_kwargs={"foreign_keys": "[Message.user_id]"},
    )

    # New relationship for file attachments
    uploaded_files: List["UserFile"] = Relationship(back_populates="user")  # noqa: F821
    subject_interests: List["UserSubjectInterest"] = Relationship(back_populates="user")  # noqa: F821

    # Add the missing notes relationship
    notes: List["Note"] = Relationship(back_populates="owner")  # noqa: F821

    # Add the missing note_folders relationship
    note_folders: List["NoteFolder"] = Relationship(back_populates="owner")  # noqa: F821

    # Add the missing note_collaborations relationship
    note_collaborations: List["NoteCollaborator"] = Relationship(back_populates="user")  # noqa: F821

    whiteboard_sessions: List["WhiteboardSession"] = Relationship(back_populates="user")  # noqa: F821

class UserFile(SQLModel, table=True):
    """Enhanced model for tracking file uploads across the application"""

    __tablename__ = "user_files"

    id: int = Field(default=None, primary_key=True)
    user_id: int = Field(foreign_key="users.id", index=True)

    # File details
    file_key: str  # S3 key/path
    file_name: str
    file_type: str  # MIME type
    file_size: int  # Size in bytes
    file_url: str  # Permanent URL
    thumbnail_url: Optional[str] = None  # Optional thumbnail for images/documents

    # Categorization
    file_category: str = Field(
        index=True
    )  # avatar, course_material, assignment, message_attachment, etc.
    session_id: Optional[str] = Field(
        default=None, index=True
    )  # For chat/tutor sessions
    reference_id: Optional[str] = Field(
        default=None, index=True
    )  # Reference to other entity (assignment, message, etc)

    # Enhanced sharing and management
    owner_type: str = Field(default="user", index=True)  # user, professor, admin, system
    is_deleted: bool = Field(default=False)
    is_public: bool = Field(default=False)  # Globally accessible
    shared_with: List[Dict[str, Any]] = Field(default=[], sa_type=JSON)  # List of user IDs or roles with access
    sharing_level: str = Field(default="private")  # private, shared, department, school, public

    # Academic context
    course_id: Optional[int] = Field(default=None, index=True)
    school_id: Optional[int] = Field(default=None, index=True)
    department_id: Optional[int] = Field(default=None, index=True)

    # Content metadata
    file_metadata: Dict[str, Any] = Field(default={}, sa_type=JSON)
    content_status: str = Field(default="ready")  # ready, processing, error

    # Source tracking
    uploaded_by_name: Optional[str] = None  # For display purposes
    source_type: Optional[str] = None  # upload, generation, system, etc.

    # Timestamps
    created_at: datetime = Field(default_factory=datetime.utcnow)
    updated_at: Optional[datetime] = None
    expires_at: Optional[datetime] = None  # For temporary files

    # Relationships
    user: User = Relationship(back_populates="uploaded_files")

class Guardian(SQLModel, table=True):
    """Model for parent/guardian relationships to students."""

    id: Optional[int] = Field(default=None, primary_key=True)
    student_id: int = Field(foreign_key="users.id", index=True)
    parent_id: int = Field(foreign_key="users.id", index=True)
    relationship: str  # "parent", "guardian", "teacher", "counselor"
    can_view_progress: bool = True
    can_view_messages: bool = True
    can_edit_profile: bool = False
    created_at: datetime = Field(default_factory=datetime.utcnow)

    # Relationships
    student: User = Relationship(
        back_populates="guardians",
        sa_relationship_kwargs={"primaryjoin": "Guardian.student_id==User.id"},
    )
    parent: User = Relationship(
        back_populates="supervised_students",
        sa_relationship_kwargs={"primaryjoin": "Guardian.parent_id==User.id"},
    )


File: backend/src/db/models/whiteboard.py
from datetime import datetime
from typing import List, Optional, Dict, Any
from sqlmodel import Field, SQLModel, Relationship, JSON
import uuid

from .user import User
from .tutoring import DetailedTutoringSession


class WhiteboardSession(SQLModel, table=True):
    """Model for interactive whiteboard tutoring sessions."""

    id: str = Field(default_factory=lambda: str(uuid.uuid4()), primary_key=True)
    user_id: int = Field(foreign_key="users.id", index=True)
    related_session_id: Optional[str] = Field(
        default=None, foreign_key="detailed_tutoring_session.id", index=True
    )

    # Session details
    title: str
    description: Optional[str] = None
    status: str = "active"  # "active", "paused", "completed", "archived"

    # Academic context - making subject_id and topic_id truly optional
    # No foreign key constraint for flexibility
    subject_id: Optional[int] = Field(default=None, index=True)
    topic_id: Optional[int] = Field(default=None, index=True)
    education_level: Optional[str] = None  # primary_1, bac_2, etc.

    # Session timing
    start_time: datetime = Field(default_factory=datetime.utcnow)
    end_time: Optional[datetime] = None
    duration_seconds: Optional[int] = None

    # Content storage
    current_state: Dict[str, Any] = Field(default={}, sa_type=JSON)  # Desmos state
    snapshots: List[Dict[str, Any]] = Field(
        default=[], sa_type=JSON
    )  # List of board states during session

    # AI integration
    ai_enabled: bool = True
    ai_model: Optional[str] = None

    # Timestamps
    created_at: datetime = Field(default_factory=datetime.utcnow)
    updated_at: Optional[datetime] = None

    # Relationships - keeping these optional since we're no longer enforcing foreign keys
    user: "User" = Relationship(back_populates="whiteboard_sessions")
    related_session: Optional["DetailedTutoringSession"] = Relationship()
    interactions: List["WhiteboardInteraction"] = Relationship(back_populates="session")


class WhiteboardInteraction(SQLModel, table=True):
    """Model for interactions during a whiteboard session."""

    id: str = Field(default_factory=lambda: str(uuid.uuid4()), primary_key=True)
    session_id: str = Field(foreign_key="whiteboardsession.id", index=True)

    # Interaction details
    type: str  # "screenshot", "query", "response", "annotation", "equation"
    content: Dict[str, Any] = Field(
        sa_type=JSON
    )  # Flexible storage for various interaction types

    # Screenshot specific fields
    image_url: Optional[str] = None
    ocr_text: Optional[str] = None

    # Timing
    timestamp: datetime = Field(default_factory=datetime.utcnow)

    # AI processing
    ai_processed: bool = False
    ai_response: Optional[Dict[str, Any]] = Field(default=None, sa_type=JSON)
    processing_time_ms: Optional[int] = None

    # Relationships
    session: WhiteboardSession = Relationship(back_populates="interactions")


File: backend/src/db/models/recommendations.py
from datetime import datetime
from typing import Optional, Dict, Any
from sqlmodel import Field, SQLModel, Relationship, JSON

from .user import User
from .content import Subject, Lesson, Topic

from .content import Course

from typing import List


class Recommendation(SQLModel, table=True):
    """Model for personalized learning recommendations."""

    id: Optional[int] = Field(default=None, primary_key=True)
    user_id: int = Field(foreign_key="users.id")

    # Recommendation details
    type: str  # "topic", "lesson", "practice", "tutoring", "course"
    title: str
    description: str
    priority: int = 3  # 1-5 (1 = highest)
    image_url: Optional[str] = None

    # Reference IDs (optional, depends on recommendation type)
    subject_id: Optional[int] = Field(default=None, foreign_key="subject.id")
    topic_id: Optional[int] = Field(default=None, foreign_key="topic.id")
    lesson_id: Optional[int] = Field(default=None, foreign_key="lesson.id")
    course_id: Optional[int] = Field(default=None, foreign_key="course.id")

    # Additional data
    data: Dict[str, Any] = Field(default={}, sa_type=JSON)

    # Status
    created_at: datetime = Field(default_factory=datetime.utcnow)
    viewed_at: Optional[datetime] = None
    acted_upon: bool = False
    expires_at: Optional[datetime] = None

    # Relationships
    user: User = Relationship(back_populates="recommendations")
    subject: Optional[Subject] = Relationship()
    topic: Optional[Topic] = Relationship()
    lesson: Optional[Lesson] = Relationship()
    course: Optional[Course] = Relationship()


class ExplorationTopic(SQLModel, table=True):
    """Model for curated exploration topics shown on dashboard."""

    id: Optional[int] = Field(default=None, primary_key=True)
    title: str
    description: str
    type: str  # "academic", "interdisciplinary", "cultural", "current-event"
    image_url: Optional[str] = None
    is_featured: bool = False
    is_new: bool = False

    # Topic connections
    connects_concepts: List[str] = Field(default=[], sa_type=JSON)
    related_subjects: List[str] = Field(default=[], sa_type=JSON)

    # Display details
    color_scheme: Optional[str] = None
    icon: Optional[str] = None

    # Content and metadata
    content: Dict[str, Any] = Field(default={}, sa_type=JSON)
    created_at: datetime = Field(default_factory=datetime.utcnow)
    meta_data: Dict[str, Any] = Field(default={}, sa_type=JSON)


File: backend/src/db/models/__init__.py
"""Initialize database models and handle circular imports."""

# Import all models in a way that avoids circular import issues
from typing import Dict, Type
from sqlmodel import SQLModel

# Import all model files - the imports themselves register the models
from .user import User, Guardian
from .content import Subject, Topic, Lesson, Course, CourseTopic, UserSubjectInterest
from .progress import Enrollment, Activity, Achievement
from .recommendations import Recommendation, ExplorationTopic
from .tutoring import (
    TutoringSession,
    DetailedTutoringSession,
    TutoringExchange,
    SessionResource,
)
from .communication import Notification, Message
from .community import StudySession, StudyGroup, StudyGroupMember, ForumPost, ForumReply

# Import school-related models
from .school import (
    School,
    Department,
    SchoolClass,
    SchoolStaff,
    DepartmentStaffAssignment,
    SchoolCourse,
    SchoolStudent,
    ClassEnrollment,
    CourseEnrollment,
    ClassSchedule,
    Assignment,
    AssignmentSubmission,
    LessonPlan,
    AttendanceRecord,
    SchoolAnnouncement,
)

# Import professor-related models
from .professor import (
    SchoolProfessor,
    ProfessorCourse,
    CourseMaterial,
)

# Import whiteboard models
from .whiteboard import WhiteboardSession, WhiteboardInteraction

# Import note-related models
from .notes import Note, NoteFolder, NoteCollaborator, AISuggestion

# Also import CourseAITutoringSession model to fix relationships
from .tutoring_integration import CourseAITutoringSession

from .flashcard import Flashcard

# Dictionary to store all model classes
models: Dict[str, Type[SQLModel]] = {}

# Expose all models in __all__ for star imports
__all__ = [
    # User models
    "User",
    "Guardian",
    # Content models
    "Subject",
    "Topic",
    "Lesson",
    "Course",
    "CourseTopic",
    "UserSubjectInterest",
    # Progress tracking models
    "Enrollment",
    "Activity",
    "Achievement",
    # AI Tutoring models
    "TutoringSession",
    "DetailedTutoringSession",
    "TutoringExchange",
    "SessionResource",
    "CourseAITutoringSession",
    # Recommendation models
    "Recommendation",
    "ExplorationTopic",
    # Communication models
    "Notification",
    "Message",
    # Community and social learning models
    "StudySession",
    "StudyGroup",
    "StudyGroupMember",
    "ForumPost",
    "ForumReply",
    # School models
    "School",
    "Department",
    "SchoolClass",
    "SchoolStaff",
    "DepartmentStaffAssignment",
    "SchoolCourse",
    "SchoolStudent",
    "ClassEnrollment",
    "CourseEnrollment",
    "ClassSchedule",
    "Assignment",
    "AssignmentSubmission",
    "LessonPlan",
    "AttendanceRecord",
    "SchoolAnnouncement",
    # Professor models
    "SchoolProfessor",
    "ProfessorCourse",
    "CourseMaterial",
    # Whiteboard models
    "WhiteboardSession",
    "WhiteboardInteraction",
    # Notes models
    "Note",
    "NoteFolder",
    "NoteCollaborator",
    "AISuggestion",
    # Flashcard models
    "Flashcard",
]


# Verify that all models are properly loaded
def verify_models():
    """Verify that all expected models are loaded and registered."""
    missing_models = [model for model in __all__ if model not in globals()]
    if missing_models:
        raise ImportError(
            f"Failed to import the following models: {', '.join(missing_models)}"
        )


# Run verification when the module is imported
verify_models()


File: backend/src/db/models/notes.py
from datetime import datetime
from typing import Optional, List
from sqlmodel import Field, SQLModel, Relationship, JSON
import uuid
from sqlalchemy import UniqueConstraint

from .user import User


class Note(SQLModel, table=True):
    """Model for user notes."""

    __tablename__ = "notes"

    id: str = Field(default_factory=lambda: str(uuid.uuid4()), primary_key=True)
    title: str
    content: str
    folder_id: Optional[str] = Field(
        default=None, foreign_key="note_folders.id", index=True
    )
    tags: List[str] = Field(default=[], sa_type=JSON)
    owner_id: int = Field(foreign_key="users.id", index=True)
    created_at: datetime = Field(default_factory=datetime.utcnow)
    updated_at: datetime = Field(default_factory=datetime.utcnow)
    version: int = Field(default=1)
    ai_enhanced: bool = Field(default=False)

    # Relationships
    owner: "User" = Relationship(back_populates="notes")
    folder: Optional["NoteFolder"] = Relationship(back_populates="notes")
    collaborators: List["NoteCollaborator"] = Relationship(
        back_populates="note", sa_relationship_kwargs={"cascade": "all, delete-orphan"}
    )
    ai_suggestions: List["AISuggestion"] = Relationship(
        back_populates="note", sa_relationship_kwargs={"cascade": "all, delete-orphan"}
    )


class NoteFolder(SQLModel, table=True):
    """Model for organizing notes into folders."""

    __tablename__ = "note_folders"

    id: str = Field(default_factory=lambda: str(uuid.uuid4()), primary_key=True)
    name: str
    parent_id: Optional[str] = Field(default=None, foreign_key="note_folders.id")
    owner_id: int = Field(foreign_key="users.id", index=True)
    created_at: datetime = Field(default_factory=datetime.utcnow)
    updated_at: datetime = Field(default_factory=datetime.utcnow)

    # Relationships
    owner: "User" = Relationship(back_populates="note_folders")
    notes: List["Note"] = Relationship(back_populates="folder")
    # Self-referential relationship for parent-child folders
    parent: Optional["NoteFolder"] = Relationship(
        sa_relationship_kwargs={"remote_side": "NoteFolder.id"}
    )
    children: List["NoteFolder"] = Relationship(
        sa_relationship_kwargs={"back_populates": "parent"}
    )


class NoteCollaborator(SQLModel, table=True):
    """Model for collaborative access to notes."""

    __tablename__ = "note_collaborators"

    id: str = Field(default_factory=lambda: str(uuid.uuid4()), primary_key=True)
    note_id: str = Field(foreign_key="notes.id", index=True)
    user_id: int = Field(foreign_key="users.id", index=True)
    permissions: str = Field(
        default="read", description="Permission level: read, write, admin"
    )
    joined_at: datetime = Field(default_factory=datetime.utcnow)

    # Relationships
    note: Note = Relationship(back_populates="collaborators")
    user: "User" = Relationship(back_populates="note_collaborations")

    # Unique constraint to ensure one collaboration per user per note
    __table_args__ = (UniqueConstraint("note_id", "user_id", name="uix_note_user"),)


class AISuggestion(SQLModel, table=True):
    """Model for AI-generated suggestions for notes."""

    __tablename__ = "ai_suggestions"

    id: str = Field(default_factory=lambda: str(uuid.uuid4()), primary_key=True)
    note_id: str = Field(foreign_key="notes.id", index=True)
    content: str
    type: str = Field(
        description="Suggestion type: completion, clarification, connection, insight"
    )
    created_at: datetime = Field(default_factory=datetime.utcnow)
    applied: bool = Field(default=False)

    # Relationships
    note: Note = Relationship(back_populates="ai_suggestions")


File: backend/src/db/models/tutoring_integration.py
from datetime import datetime
from typing import Optional, Dict, Any
from sqlmodel import Field, SQLModel, Relationship, JSON


class CourseAITutoringSession(SQLModel, table=True):
    """Model for AI tutoring sessions integrated with courses."""

    id: Optional[int] = Field(default=None, primary_key=True)
    course_id: int = Field(foreign_key="schoolcourse.id", index=True)
    student_id: int = Field(foreign_key="schoolstudent.id", index=True)

    # Session details
    title: str
    start_time: datetime = Field(default_factory=datetime.utcnow)
    end_time: Optional[datetime] = None
    duration_seconds: Optional[int] = None

    # Session data
    context: Dict[str, Any] = Field(default={}, sa_type=JSON)
    learning_objectives: Dict[str, Any] = Field(default={}, sa_type=JSON)

    # Status
    status: str = "active"  # active, completed, paused

    # Relationships
    course: "SchoolCourse" = Relationship(back_populates="tutoring_sessions")  # noqa: F821

    # Timestamps
    created_at: datetime = Field(default_factory=datetime.utcnow)
    updated_at: Optional[datetime] = None


File: backend/src/db/models/professor.py
from datetime import datetime
from typing import List, Optional, Dict, Any
from sqlmodel import Field, SQLModel, Relationship, JSON


class SchoolProfessor(SQLModel, table=True):
    """Enhanced model for professors with school integration."""

    id: Optional[int] = Field(default=None, primary_key=True)
    user_id: int = Field(foreign_key="users.id", index=True)
    school_id: int = Field(foreign_key="school.id", index=True)

    # Academic Profile
    title: str  # Prof., Dr., etc.
    department_id: Optional[int] = Field(default=None, foreign_key="department.id")
    specializations: List[str] = Field(default=[], sa_type=JSON)
    academic_rank: str  # Assistant Professor, Associate Professor, etc.
    tenure_status: Optional[str] = None

    # Teaching Details
    teaching_languages: List[str] = Field(default=[], sa_type=JSON)
    preferred_subjects: List[str] = Field(default=[], sa_type=JSON)
    education_levels: List[str] = Field(default=[], sa_type=JSON)

    # Contact & Availability
    office_location: Optional[str] = None
    office_hours: Dict[str, Any] = Field(default={}, sa_type=JSON)
    contact_preferences: Dict[str, Any] = Field(default={}, sa_type=JSON)

    # Platform Integration
    ai_collaboration_preferences: Dict[str, Any] = Field(default={}, sa_type=JSON)
    tutoring_availability: bool = True
    max_students: Optional[int] = None

    # Onboarding Status
    has_completed_onboarding: bool = Field(default=False)
    onboarding_started_at: Optional[datetime] = None
    onboarding_completed_at: Optional[datetime] = None
    onboarding_step: Optional[str] = Field(
        default="profile",
        description="Current onboarding step: profile, expertise, availability, courses, teaching_materials",
    )
    onboarding_progress: int = Field(
        default=0, description="Progress percentage (0-100)"
    )

    # Timestamps
    joined_at: datetime = Field(default_factory=datetime.utcnow)
    last_active: Optional[datetime] = None

    # Status
    is_active: bool = True
    account_status: str = "active"  # active, inactive, on_leave

    # Metadata
    meta_data: Dict[str, Any] = Field(default={}, sa_type=JSON)

    # Relationships
    user: "User" = Relationship()  # noqa: F821
    school: "School" = Relationship()  # noqa: F821
    department: Optional["Department"] = Relationship()  # noqa: F821
    courses: List["ProfessorCourse"] = Relationship(back_populates="professor")  # noqa: F821
    course_materials: List["CourseMaterial"] = Relationship(back_populates="professor")  # noqa: F821
    assignments: List["Assignment"] = Relationship(back_populates="professor")  # noqa: F821


class ProfessorCourse(SQLModel, table=True):
    """Model for managing professor-course relationships and responsibilities."""

    id: Optional[int] = Field(default=None, primary_key=True)
    professor_id: int = Field(foreign_key="schoolprofessor.id", index=True)
    course_id: int = Field(foreign_key="schoolcourse.id", index=True)

    # Role and Responsibilities
    role: str = "primary"  # primary, secondary, guest, advisor
    responsibilities: List[str] = Field(default=[], sa_type=JSON)

    # Time Period
    academic_year: str = Field(index=True)
    semester: Optional[str] = None
    start_date: datetime
    end_date: Optional[datetime] = None

    # Course Customization
    custom_syllabus: Optional[Dict[str, Any]] = Field(default=None, sa_type=JSON)
    teaching_notes: Optional[Dict[str, Any]] = Field(default=None, sa_type=JSON)

    # Status
    status: str = "active"  # active, completed, planned

    # Timestamps
    created_at: datetime = Field(default_factory=datetime.utcnow)
    updated_at: Optional[datetime] = None

    # Relationships
    professor: SchoolProfessor = Relationship(back_populates="courses")
    course: "SchoolCourse" = Relationship(back_populates="professors")  # noqa: F821

class CourseMaterial(SQLModel, table=True):
    """Model for managing course materials and resources."""

    id: Optional[int] = Field(default=None, primary_key=True)
    course_id: int = Field(foreign_key="schoolcourse.id", index=True)
    professor_id: int = Field(foreign_key="schoolprofessor.id", index=True)

    # Material Details
    title: str
    description: str
    material_type: str  # lecture_notes, presentation, worksheet, example, reference

    # Content - for text-based materials or JSON structured content
    content: Dict[str, Any] = Field(default={}, sa_type=JSON)

    # File association - link to UserFile
    file_id: Optional[int] = Field(default=None, foreign_key="user_files.id")

    # Organization
    unit: Optional[str] = None
    sequence: Optional[int] = None
    tags: List[str] = Field(default=[], sa_type=JSON)

    # Access Control
    visibility: str = "students"  # students, professors, public
    requires_completion: bool = False

    # AI Integration
    ai_enhanced: bool = False
    ai_features: Dict[str, Any] = Field(default={}, sa_type=JSON)

    # Timestamps
    created_at: datetime = Field(default_factory=datetime.utcnow)
    updated_at: Optional[datetime] = None

    # Relationships
    course: "SchoolCourse" = Relationship(back_populates="materials")
    professor: SchoolProfessor = Relationship(back_populates="course_materials")
    file: Optional["UserFile"] = Relationship()  # One-way reference

File: backend/src/db/models/content.py
from datetime import datetime
from typing import List, Optional, Dict, Any
from sqlmodel import Field, SQLModel, Relationship, JSON


class Subject(SQLModel, table=True):
    """Enhanced subject model with education level mapping"""

    id: Optional[int] = Field(default=None, primary_key=True)
    name: str = Field(index=True)

    # Updated to match education_level in User model
    grade_level: str = Field(index=True)  # primary_1, bac_2, university, etc.

    description: str
    icon: Optional[str] = None
    color_scheme: Optional[str] = None
    meta_data: Optional[Dict[str, Any]] = Field(default=None, sa_type=JSON)

    # Added fields to match subject options in onboarding
    subject_code: str = Field(index=True)  # mathematics, physics, arabic, etc.
    teaching_language: Optional[str] = None  # ar, fr, en

    # For university subjects
    university_track: Optional[str] = None  # uni_fs, uni_medicine, etc.

    # For high school subjects
    academic_track: Optional[str] = None  # sciences_math_a, lettres_phil, etc.

    # Relationships (existing)
    topics: List["Topic"] = Relationship(back_populates="subject")
    enrollments: List["Enrollment"] = Relationship(back_populates="subject")  # noqa: F821
    courses: List["Course"] = Relationship(back_populates="subject")  # noqa: F821

    # New relationships for onboarding preferences
    interested_users: List["UserSubjectInterest"] = Relationship(
        back_populates="subject"
    )


class UserSubjectInterest(SQLModel, table=True):
    """New model to track user subject interests from onboarding"""

    id: Optional[int] = Field(default=None, primary_key=True)
    user_id: int = Field(foreign_key="users.id", index=True)
    subject_id: int = Field(foreign_key="subject.id", index=True)
    interest_level: int = 5  # Scale 1-5, default high since selected in onboarding
    created_at: datetime = Field(default_factory=datetime.utcnow)

    # Relationships
    user: "User" = Relationship(back_populates="subject_interests")  # noqa: F821
    subject: "Subject" = Relationship(back_populates="interested_users")  # noqa: F821


class Course(SQLModel, table=True):
    """Enhanced course model with education level and track mapping"""

    id: Optional[int] = Field(default=None, primary_key=True)
    title: str
    subject_id: int = Field(foreign_key="subject.id")
    description: str
    difficulty_level: int = 3  # 1-5 scale
    is_featured: bool = False
    is_new: bool = False
    created_at: datetime = Field(default_factory=datetime.utcnow)

    # Added fields to match education levels and tracks
    education_level: str = Field(index=True)  # primary_1, bac_2, university, etc.
    academic_track: Optional[str] = Field(
        default=None, index=True
    )  # sciences_math_a, uni_medicine
    region_specific: bool = False
    region: Optional[str] = None  # For region-specific curriculum

    # Metadata enhanced to store preferences that would make this course relevant
    meta_data: Optional[Dict[str, Any]] = Field(default=None, sa_type=JSON)

    # Relationships (existing)
    subject: Subject = Relationship(back_populates="courses")
    course_topics: List["CourseTopic"] = Relationship(back_populates="course")


class Topic(SQLModel, table=True):
    """Model for topics within subjects."""

    id: Optional[int] = Field(default=None, primary_key=True)
    name: str
    subject_id: int = Field(foreign_key="subject.id")
    description: str
    order: int  # Sequence within subject
    difficulty: int = 3  # 1-5 scale
    estimated_duration_minutes: Optional[int] = None
    meta_data: Optional[Dict[str, Any]] = Field(
        default=None, sa_type=JSON
    )  # For time periods, prerequisites, etc.

    # Relationships
    subject: Subject = Relationship(back_populates="topics")
    lessons: List["Lesson"] = Relationship(back_populates="topic")
    tutoring_sessions: List["TutoringSession"] = Relationship(back_populates="topic")  # noqa: F821
    detailed_tutoring_sessions: List["DetailedTutoringSession"] = Relationship(  # noqa: F821
        back_populates="topic"
    )


class CourseTopic(SQLModel, table=True):
    """Mapping between courses and topics with sequence order."""

    id: Optional[int] = Field(default=None, primary_key=True)
    course_id: int = Field(foreign_key="course.id")
    topic_id: int = Field(foreign_key="topic.id")
    order: int  # Sequence within course

    # Relationships
    course: Course = Relationship(back_populates="course_topics")
    topic: Topic = Relationship()


class Lesson(SQLModel, table=True):
    """Model for lessons within topics."""

    id: Optional[int] = Field(default=None, primary_key=True)
    title: str
    topic_id: int = Field(foreign_key="topic.id")
    content_type: str  # "video", "text", "interactive", "quiz", etc.
    content: Dict[str, Any] = Field(
        default={}, sa_type=JSON
    )  # Flexible content storage
    order: int  # Sequence within topic
    duration_minutes: Optional[int] = None
    difficulty: int = 3  # 1-5 scale
    meta_data: Optional[Dict[str, Any]] = Field(default=None, sa_type=JSON)

    # Relationships
    topic: Topic = Relationship(back_populates="lessons")
    activities: List["Activity"] = Relationship(back_populates="lesson")  # noqa: F821


File: backend/src/db/models/community.py
from datetime import datetime
from typing import Optional, List
from sqlmodel import Field, SQLModel, Relationship, JSON

from .user import User
from .content import Subject, Topic


class StudySession(SQLModel, table=True):
    """Model for scheduled study sessions."""

    id: Optional[int] = Field(default=None, primary_key=True)
    user_id: int = Field(foreign_key="users.id")

    title: str
    session_type: str  # "focused", "practice", "homework", "review"
    start_time: datetime
    end_time: Optional[datetime] = None
    duration_minutes: int

    # Link to content
    subject_id: Optional[int] = Field(default=None, foreign_key="subject.id")
    topic_id: Optional[int] = Field(default=None, foreign_key="topic.id")

    # Status
    status: str = "scheduled"  # "scheduled", "in_progress", "completed", "cancelled"

    # Results
    summary: Optional[str] = None
    productivity_score: Optional[float] = None
    achievements: List[str] = Field(default=[], sa_type=JSON)

    # Relationships
    user: User = Relationship()
    subject: Optional[Subject] = Relationship()
    topic: Optional[Topic] = Relationship()


class StudyGroup(SQLModel, table=True):
    """Model for community study groups."""

    id: Optional[int] = Field(default=None, primary_key=True)
    name: str
    description: str
    created_by: int = Field(foreign_key="users.id")

    # Group details
    subject_id: Optional[int] = Field(default=None, foreign_key="subject.id")
    grade_level: Optional[str] = None
    is_private: bool = False

    # Status
    created_at: datetime = Field(default_factory=datetime.utcnow)
    active: bool = True

    # Relationships
    creator: User = Relationship(
        sa_relationship_kwargs={"foreign_keys": "[StudyGroup.created_by]"}
    )
    subject: Optional[Subject] = Relationship()
    members: List["StudyGroupMember"] = Relationship(back_populates="group")


class StudyGroupMember(SQLModel, table=True):
    """Model for study group membership."""

    id: Optional[int] = Field(default=None, primary_key=True)
    group_id: int = Field(foreign_key="studygroup.id")
    user_id: int = Field(foreign_key="users.id")

    # Membership details
    role: str = "member"  # "member", "moderator", "admin"
    joined_at: datetime = Field(default_factory=datetime.utcnow)

    # Relationships
    group: StudyGroup = Relationship(back_populates="members")
    user: User = Relationship()


class ForumPost(SQLModel, table=True):
    """Model for community forum posts."""

    id: Optional[int] = Field(default=None, primary_key=True)
    author_id: int = Field(foreign_key="users.id")

    title: str
    content: str

    # Categorization
    subject_id: Optional[int] = Field(default=None, foreign_key="subject.id")
    topic_id: Optional[int] = Field(default=None, foreign_key="topic.id")
    tags: List[str] = Field(default=[], sa_type=JSON)

    # Status
    created_at: datetime = Field(default_factory=datetime.utcnow)
    updated_at: Optional[datetime] = None
    is_pinned: bool = False
    is_approved: bool = True

    # Statistics
    view_count: int = 0
    upvote_count: int = 0

    # Relationships
    author: User = Relationship()
    subject: Optional[Subject] = Relationship()
    topic: Optional[Topic] = Relationship()
    replies: List["ForumReply"] = Relationship(back_populates="post")


class ForumReply(SQLModel, table=True):
    """Model for replies to forum posts."""

    id: Optional[int] = Field(default=None, primary_key=True)
    post_id: int = Field(foreign_key="forumpost.id")
    author_id: int = Field(foreign_key="users.id")

    content: str

    # Status
    created_at: datetime = Field(default_factory=datetime.utcnow)
    updated_at: Optional[datetime] = None
    is_solution: bool = False

    # Stats
    upvote_count: int = 0

    # Relationships
    post: ForumPost = Relationship(back_populates="replies")
    author: User = Relationship()


class StudyGroupMessage(SQLModel, table=True):
    """Model for messages in study group chats."""

    id: Optional[int] = Field(default=None, primary_key=True)
    group_id: int = Field(foreign_key="studygroup.id", index=True)
    user_id: int = Field(foreign_key="users.id", index=True)

    content: str
    is_system_message: bool = False
    is_deleted: bool = False

    created_at: datetime = Field(default_factory=datetime.utcnow)
    updated_at: Optional[datetime] = None

    # Relationships
    group: "StudyGroup" = Relationship()
    user: "User" = Relationship()


class CommunityFeedItem(SQLModel, table=True):
    """Model for community feed items."""

    id: Optional[int] = Field(default=None, primary_key=True)

    # Item metadata
    item_type: str  # "forum_post", "group_update", "announcement", etc.
    title: str
    content: str

    # Source information
    source: str  # "forum", "group", "system", etc.
    source_id: Optional[int] = None  # Optional ID of the source

    # Visibility and targeting
    is_public: bool = True
    group_id: Optional[int] = Field(
        default=None, foreign_key="studygroup.id", index=True
    )
    target_user_id: Optional[int] = Field(
        default=None, foreign_key="users.id", index=True
    )

    # For attaching to specific entities
    related_post_id: Optional[int] = Field(default=None, foreign_key="forumpost.id")
    related_reply_id: Optional[int] = Field(default=None, foreign_key="forumreply.id")

    # Timestamps
    created_at: datetime = Field(default_factory=datetime.utcnow)
    expires_at: Optional[datetime] = None

    # Relationships
    group: Optional["StudyGroup"] = Relationship()
    target_user: Optional["User"] = Relationship(
        sa_relationship_kwargs={"foreign_keys": "[CommunityFeedItem.target_user_id]"}
    )
    related_post: Optional["ForumPost"] = Relationship()
    related_reply: Optional["ForumReply"] = Relationship()


File: backend/src/db/models/tutoring.py
from datetime import datetime
from typing import List, Optional, Dict, Any
from sqlmodel import Field, SQLModel, Relationship, JSON
from sqlalchemy import Column, String

from .user import User
from .content import Topic


class TutoringSession(SQLModel, table=True):
    """Model for basic AI tutoring sessions."""

    id: Optional[int] = Field(default=None, primary_key=True)
    user_id: int = Field(foreign_key="users.id")
    topic_id: int = Field(foreign_key="topic.id")

    # Session details
    title: str  # Derived from initial question or topic
    start_time: datetime = Field(default_factory=datetime.utcnow)
    end_time: Optional[datetime] = None
    duration_seconds: Optional[int] = None
    status: str = "active"  # "active", "completed", "abandoned"

    # Session data
    context: Dict[str, Any] = Field(default={}, sa_type=JSON)
    feedback: Dict[str, Any] = Field(default={}, sa_type=JSON)
    messages: Dict[str, Any] = Field(default={}, sa_type=JSON)

    # Analytics
    total_messages: int = 0
    user_messages: int = 0
    ai_messages: int = 0
    topics_covered: List[str] = Field(default=[], sa_type=JSON)

    # Relationships
    user: User = Relationship(back_populates="tutoring_sessions")
    topic: Topic = Relationship(back_populates="tutoring_sessions")


class DetailedTutoringSession(SQLModel, table=True):
    """Advanced model for AI tutoring sessions with various interaction modes."""

    __tablename__ = "detailed_tutoring_session"

    # Keep string ID type to support UUIDs, but properly configure it using Column
    id: str = Field(sa_column=Column(String, primary_key=True))
    user_id: int = Field(foreign_key="users.id", index=True)
    topic_id: Optional[int] = Field(default=None, foreign_key="topic.id", index=True)

    # Session core info
    title: str  # Descriptive title for the session
    session_type: str = Field(index=True)  # "chat", "whiteboard", "video", "notes"
    interaction_mode: str  # "text-only", "voice", "ocr-enabled", "interactive-diagram"

    # Use datetime.utcnow without timezone info for PostgreSQL compatibility
    start_time: datetime = Field(default_factory=datetime.utcnow)
    end_time: Optional[datetime] = None
    duration_seconds: Optional[int] = None
    status: str = "active"  # "active", "paused", "completed", "abandoned"

    # Initial context
    initial_query: str  # The initial question or topic
    difficulty: Optional[int] = None  # 1-5 if applicable

    # LLM
    provider: Optional[str] = None  # openai, groq, etc.
    model: Optional[str] = None
    # Session configuration
    config: Dict[str, Any] = Field(default={}, sa_type=JSON)

    # Learning outcomes
    concepts_learned: List[str] = Field(default=[], sa_type=JSON)
    skills_practiced: List[str] = Field(default=[], sa_type=JSON)

    # Relationships
    user: User = Relationship(back_populates="detailed_tutoring_sessions")
    topic: Optional[Topic] = Relationship(back_populates="detailed_tutoring_sessions")
    exchanges: List["TutoringExchange"] = Relationship(back_populates="session")
    resources: List["SessionResource"] = Relationship(back_populates="session")
    flashcards: List["Flashcard"] = Relationship(back_populates="session")  # noqa: F821


class TutoringExchange(SQLModel, table=True):
    """Model for back-and-forth exchanges in a tutoring session."""

    id: Optional[int] = Field(default=None, primary_key=True)
    # Reference string ID (UUID) from detailed_tutoring_session
    session_id: str = Field(foreign_key="detailed_tutoring_session.id", index=True)
    sequence: int  # Order in the conversation
    timestamp: datetime = Field(default_factory=datetime.utcnow)

    # Student input
    student_input_type: str  # "text", "voice", "ocr", "drawing", "file-upload"
    student_input: Dict[str, Any] = Field(sa_type=JSON)

    # AI response
    ai_response_type: str  # "text", "voice", "diagram", "annotation", "correction"
    ai_response: Dict[str, Any] = Field(sa_type=JSON)

    # Learning signals
    learning_signals: Dict[str, Any] = Field(default={}, sa_type=JSON)

    # Bookmarked status
    is_bookmarked: bool = False
    bookmarked_at: Optional[datetime] = None

    # Relationships
    session: DetailedTutoringSession = Relationship(back_populates="exchanges")


class SessionResource(SQLModel, table=True):
    """Model for resources used or created during a tutoring session."""

    id: Optional[int] = Field(default=None, primary_key=True)
    # Reference string ID (UUID) from detailed_tutoring_session
    session_id: str = Field(foreign_key="detailed_tutoring_session.id", index=True)

    # Resource info
    resource_type: str  # "formula", "diagram", "example", "summary", "practice-problem"
    title: str
    content: Dict[str, Any] = Field(sa_type=JSON)
    created_at: datetime = Field(default_factory=datetime.utcnow)

    # Usage
    student_saved: bool = False
    saved_at: Optional[datetime] = None

    # Relationships
    session: DetailedTutoringSession = Relationship(back_populates="resources")


File: backend/src/db/models/communication.py
from datetime import datetime
from typing import Optional, Dict, Any
from sqlmodel import Field, SQLModel, Relationship, JSON

from .user import User


class Notification(SQLModel, table=True):
    """Model for user notifications."""

    id: Optional[int] = Field(default=None, primary_key=True)
    user_id: int = Field(foreign_key="users.id")

    title: str
    content: str
    type: str  # "achievement", "reminder", "system", "progress", "social"
    is_read: bool = False
    created_at: datetime = Field(default_factory=datetime.utcnow)
    read_at: Optional[datetime] = None

    # Link to relevant content
    action_type: Optional[str] = None  # "open_session", "view_progress", etc.
    action_data: Dict[str, Any] = Field(default={}, sa_type=JSON)

    # Relationships
    user: User = Relationship(back_populates="notifications")


class Message(SQLModel, table=True):
    """Model for messages between users."""

    id: Optional[int] = Field(default=None, primary_key=True)
    user_id: int = Field(foreign_key="users.id")  # Sender
    recipient_id: int = Field(foreign_key="users.id")

    subject: str
    content: str
    is_read: bool = False
    created_at: datetime = Field(default_factory=datetime.utcnow)
    read_at: Optional[datetime] = None

    # Attachments and metadata
    has_attachments: bool = False
    attachments: Dict[str, Any] = Field(default={}, sa_type=JSON)

    # Relationships
    user: User = Relationship(
        back_populates="messages",
        sa_relationship_kwargs={"foreign_keys": "[Message.user_id]"},
    )
    recipient: User = Relationship(
        sa_relationship_kwargs={"foreign_keys": "[Message.recipient_id]"}
    )


File: backend/src/db/models/flashcard.py
from datetime import datetime
from typing import List, Optional
from sqlmodel import Field, SQLModel, Relationship, JSON
import uuid

from .user import User
from .tutoring import DetailedTutoringSession


class Flashcard(SQLModel, table=True):
    """Model for storing flashcards associated with tutoring sessions."""

    id: str = Field(default_factory=lambda: str(uuid.uuid4()), primary_key=True)
    session_id: str = Field(foreign_key="detailed_tutoring_session.id", index=True)
    user_id: int = Field(foreign_key="users.id", index=True)

    # Content
    front: str  # Question or term
    back: str  # Answer or explanation
    tags: List[str] = Field(default=[], sa_type=JSON)

    # Metadata
    created_at: datetime = Field(default_factory=datetime.utcnow)
    updated_at: Optional[datetime] = None

    # Study metrics
    review_count: int = Field(default=0)
    last_reviewed: Optional[datetime] = None
    confidence_level: int = Field(default=0)  # 0-5 scale

    # Relationships
    session: DetailedTutoringSession = Relationship(back_populates="flashcards")
    user: User = Relationship()


File: backend/src/db/models/progress.py
from typing import Optional, Dict, Any, List
from sqlmodel import JSON
from datetime import datetime, timezone

from .user import User
from .content import Subject, Lesson

from sqlmodel import Relationship, SQLModel, Field


class Enrollment(SQLModel, table=True):
    """Model for subject enrollments."""

    id: Optional[int] = Field(default=None, primary_key=True)
    user_id: int = Field(foreign_key="users.id")
    subject_id: int = Field(foreign_key="subject.id")
    enrolled_at: datetime = Field(default_factory=datetime.now(timezone.utc))
    active: bool = True
    completed: bool = False
    completed_at: Optional[datetime] = None
    last_activity_at: Optional[datetime] = None

    # Progress tracking
    progress_percentage: float = 0.0
    progress_data: Dict[str, Any] = Field(default={}, sa_type=JSON)

    # Relationships
    user: User = Relationship(back_populates="enrollments")
    subject: Subject = Relationship(back_populates="enrollments")


class Activity(SQLModel, table=True):
    """Model for all learning activities including assessments."""

    id: Optional[int] = Field(default=None, primary_key=True)
    user_id: int = Field(foreign_key="users.id")
    lesson_id: Optional[int] = Field(default=None, foreign_key="lesson.id")

    # Activity details
    type: str  # "lesson", "quiz", "practice", "tutoring", "homework"
    status: str = "started"  # "started", "in_progress", "completed", "abandoned"
    start_time: datetime = Field(default_factory=datetime.now(timezone.utc))
    end_time: Optional[datetime] = None
    duration_seconds: Optional[int] = None

    # Performance metrics
    score: Optional[float] = None
    max_score: Optional[float] = None
    mastery_level: Optional[float] = None  # 0-1 scale

    # Flexible data fields for different activity types
    data: Dict[str, Any] = Field(default={}, sa_type=JSON)
    results: Dict[str, Any] = Field(default={}, sa_type=JSON)

    # Relationships
    user: User = Relationship(back_populates="activities")
    lesson: Optional[Lesson] = Relationship(back_populates="activities")


class Achievement(SQLModel, table=True):
    """Model for user achievements and badges."""

    id: Optional[int] = Field(default=None, primary_key=True)
    user_id: int = Field(foreign_key="users.id")

    title: str
    description: str
    type: str  # "badge", "milestone", "certificate", "streak"
    icon: str
    awarded_at: datetime = Field(default_factory=datetime.now(timezone.utc))
    points: int = 0
    meta_data: Dict[str, Any] = Field(default={}, sa_type=JSON)

    # Relationships
    user: User = Relationship(back_populates="achievements")


class ScheduleEntry(SQLModel, table=True):
    """Model for user's personal schedule entries (not directly tied to classes)."""

    id: Optional[int] = Field(default=None, primary_key=True)
    user_id: int = Field(foreign_key="users.id", index=True)

    # Schedule details
    title: str
    description: Optional[str] = None
    entry_type: str = Field(
        index=True
    )  # "class", "study", "homework", "exam", "custom"

    # Time information
    start_time: datetime
    end_time: datetime
    is_recurring: bool = False
    recurrence_pattern: Optional[str] = None  # "daily", "weekly", "biweekly", "monthly"
    recurrence_end_date: Optional[datetime] = None

    # For recurring events, store which days of week (0-6 for Monday-Sunday)
    days_of_week: List[int] = Field(default=[], sa_type=JSON)

    # For school-related entries
    school_class_id: Optional[int] = Field(
        default=None, foreign_key="schoolclass.id", index=True
    )
    course_id: Optional[int] = Field(
        default=None, foreign_key="schoolcourse.id", index=True
    )
    assignment_id: Optional[int] = Field(
        default=None, foreign_key="assignment.id", index=True
    )

    # For study-related entries
    subject_id: Optional[int] = Field(
        default=None, foreign_key="subject.id", index=True
    )
    topic_id: Optional[int] = Field(default=None, foreign_key="topic.id", index=True)

    # Additional data
    location: Optional[str] = None
    color: Optional[str] = None
    notification_minutes_before: Optional[int] = None

    # Status
    is_completed: bool = False
    is_cancelled: bool = False

    # Metadata
    meta_data: Dict[str, Any] = Field(default={}, sa_type=JSON)

    # Timestamps
    created_at: datetime = Field(default_factory=datetime.utcnow)
    updated_at: Optional[datetime] = None

    # Relationships
    user: "User" = Relationship(back_populates="schedule_entries")
    school_class: Optional["SchoolClass"] = Relationship()  # noqa: F821
    course: Optional["SchoolCourse"] = Relationship()  # noqa: F821
    assignment: Optional["Assignment"] = Relationship()  # noqa: F821
    subject: Optional["Subject"] = Relationship()  # noqa: F821
    topic: Optional["Topic"] = Relationship()  # noqa: F821


backend/src/
├── __init__.py
├── __pycache__
│   ├── __init__.cpython-313.pyc
│   └── main.cpython-313.pyc
├── api
│   ├── __init__.py
│   ├── __pycache__
│   │   └── __init__.cpython-313.pyc
│   ├── dependencies
│   │   ├── __init__.py
│   │   └── __pycache__
│   │       └── __init__.cpython-313.pyc
│   ├── endpoints
│   │   ├── __init__.py
│   │   ├── __pycache__
│   │   │   ├── __init__.cpython-313.pyc
│   │   │   ├── admin.cpython-313.pyc
│   │   │   ├── auth.cpython-313.pyc
│   │   │   ├── community.cpython-313.pyc
│   │   │   ├── dashboard.cpython-313.pyc
│   │   │   ├── explore.cpython-313.pyc
│   │   │   ├── learning.cpython-313.pyc
│   │   │   ├── messaging.cpython-313.pyc
│   │   │   ├── notes.cpython-313.pyc
│   │   │   ├── professor_analytics.cpython-313.pyc
│   │   │   ├── professor_school.cpython-313.pyc
│   │   │   ├── professors.cpython-313.pyc
│   │   │   ├── progress.cpython-313.pyc
│   │   │   ├── recommendations.cpython-313.pyc
│   │   │   ├── schedule.cpython-313.pyc
│   │   │   ├── school_onboarding.cpython-313.pyc
│   │   │   ├── schools.cpython-313.pyc
│   │   │   ├── students.cpython-313.pyc
│   │   │   ├── subjects.cpython-313.pyc
│   │   │   ├── tutoring.cpython-313.pyc
│   │   │   ├── users.cpython-313.pyc
│   │   │   └── whiteboard.cpython-313.pyc
│   │   ├── admin.py
│   │   ├── auth.py
│   │   ├── community.py
│   │   ├── files.py
│   │   ├── learning.py
│   │   ├── messaging.py
│   │   ├── notes.py
│   │   ├── professor_analytics.py
│   │   ├── professor_school.py
│   │   ├── professors.py
│   │   ├── progress.py
│   │   ├── recommendations.py
│   │   ├── schedule.py
│   │   ├── school_onboarding.py
│   │   ├── schools.py
│   │   ├── students.py
│   │   ├── subjects.py
│   │   ├── tutoring.py
│   │   ├── users.py
│   │   └── whiteboard.py
│   └── models
│       ├── __init__.py
│       ├── __pycache__
│       │   ├── __init__.cpython-313.pyc
│       │   ├── auth.cpython-313.pyc
│       │   ├── content.cpython-313.pyc
│       │   ├── file.cpython-313.pyc
│       │   ├── professor.cpython-313.pyc
│       │   ├── professor_analytics.cpython-313.pyc
│       │   ├── progress.cpython-313.pyc
│       │   ├── recommendation.cpython-313.pyc
│       │   ├── school.cpython-313.pyc
│       │   ├── tutoring.cpython-313.pyc
│       │   └── user.cpython-313.pyc
│       ├── auth.py
│       ├── community.py
│       ├── content.py
│       ├── file.py
│       ├── professor.py
│       ├── professor_analytics.py
│       ├── progress.py
│       ├── recommendation.py
│       ├── school.py
│       ├── tutoring.py
│       └── user.py
├── core
│   ├── __init__.py
│   ├── __pycache__
│   │   ├── __init__.cpython-313.pyc
│   │   ├── embeddings.cpython-313.pyc
│   │   ├── llm.cpython-313.pyc
│   │   ├── security.cpython-313.pyc
│   │   └── settings.cpython-313.pyc
│   ├── ai
│   │   ├── __init__.py
│   │   ├── __pycache__
│   │   │   ├── __init__.cpython-313.pyc
│   │   │   └── analytics_engine.cpython-313.pyc
│   │   ├── analytics_engine.py
│   │   └── embeddings
│   │       ├── __init__.py
│   │       ├── __pycache__
│   │       │   ├── __init__.cpython-313.pyc
│   │       │   └── course.cpython-313.pyc
│   │       └── course.py
│   ├── llm.py
│   ├── security.py
│   └── settings.py
├── db
│   ├── __init__.py
│   ├── __pycache__
│   │   ├── __init__.cpython-313.pyc
│   │   ├── postgresql.cpython-313.pyc
│   │   └── qdrant.cpython-313.pyc
│   ├── models
│   │   ├── __init__.py
│   │   ├── __pycache__
│   │   │   ├── __init__.cpython-313.pyc
│   │   │   ├── communication.cpython-313.pyc
│   │   │   ├── community.cpython-313.pyc
│   │   │   ├── content.cpython-313.pyc
│   │   │   ├── file.cpython-313.pyc
│   │   │   ├── flashcard.cpython-313.pyc
│   │   │   ├── notes.cpython-313.pyc
│   │   │   ├── professor.cpython-313.pyc
│   │   │   ├── progress.cpython-313.pyc
│   │   │   ├── recommendations.cpython-313.pyc
│   │   │   ├── school.cpython-313.pyc
│   │   │   ├── tutoring.cpython-313.pyc
│   │   │   ├── tutoring_integration.cpython-313.pyc
│   │   │   ├── user.cpython-313.pyc
│   │   │   └── whiteboard.cpython-313.pyc
│   │   ├── communication.py
│   │   ├── community.py
│   │   ├── content.py
│   │   ├── flashcard.py
│   │   ├── notes.py
│   │   ├── professor.py
│   │   ├── progress.py
│   │   ├── recommendations.py
│   │   ├── school.py
│   │   ├── tutoring.py
│   │   ├── tutoring_integration.py
│   │   ├── user.py
│   │   └── whiteboard.py
│   ├── postgresql.py
│   └── qdrant.py
├── main.py
├── services
│   ├── __pycache__
│   │   └── note_ai_service.cpython-313.pyc
│   ├── note_ai_service.py
│   └── whiteboard_ai_service.py
├── utils
│   ├── __init__.py
│   ├── __pycache__
│   │   ├── __init__.cpython-313.pyc
│   │   ├── date_utils.cpython-313.pyc
│   │   └── progress_helpers.cpython-313.pyc
│   ├── date_utils.py
│   └── progress_helpers.py
└── worker
    ├── celery_app.py
    └── tasks
        └── __init__.py

26 directories, 137 files
web/src/
├── app
│   ├── [locale]
│   │   ├── (auth)
│   │   │   ├── forgot-password
│   │   │   │   └── page.tsx
│   │   │   ├── layout.tsx
│   │   │   ├── login
│   │   │   │   └── page.tsx
│   │   │   └── register
│   │   │       └── page.tsx
│   │   ├── dashboard
│   │   │   ├── _components
│   │   │   │   ├── AdminDashboard.tsx
│   │   │   │   ├── ExploreSearch.tsx
│   │   │   │   ├── ParentDashboard.tsx
│   │   │   │   ├── StudentDashboard.tsx
│   │   │   │   └── TeacherDashboard.tsx
│   │   │   ├── admin
│   │   │   │   ├── activity
│   │   │   │   │   └── page.tsx
│   │   │   │   ├── announcements
│   │   │   │   │   └── page.tsx
│   │   │   │   ├── assignments
│   │   │   │   │   ├── [id]
│   │   │   │   │   │   └── page.tsx
│   │   │   │   │   └── page.tsx
│   │   │   │   ├── classes
│   │   │   │   │   ├── [id]
│   │   │   │   │   │   └── page.tsx
│   │   │   │   │   └── page.tsx
│   │   │   │   ├── courses
│   │   │   │   │   ├── [id]
│   │   │   │   │   │   └── page.tsx
│   │   │   │   │   ├── add
│   │   │   │   │   │   └── page.tsx
│   │   │   │   │   └── page.tsx
│   │   │   │   ├── data
│   │   │   │   │   └── page.tsx
│   │   │   │   ├── departments
│   │   │   │   │   ├── [id]
│   │   │   │   │   │   └── page.tsx
│   │   │   │   │   └── page.tsx
│   │   │   │   ├── enrollments
│   │   │   │   │   ├── [id]
│   │   │   │   │   │   └── page.tsx
│   │   │   │   │   └── page.tsx
│   │   │   │   ├── export
│   │   │   │   │   └── page.tsx
│   │   │   │   ├── import
│   │   │   │   │   └── page.tsx
│   │   │   │   ├── layout.tsx
│   │   │   │   ├── materials
│   │   │   │   │   ├── [id]
│   │   │   │   │   │   └── page.tsx
│   │   │   │   │   └── page.tsx
│   │   │   │   ├── page.tsx
│   │   │   │   ├── reports
│   │   │   │   │   ├── academic
│   │   │   │   │   │   └── page.tsx
│   │   │   │   │   └── page.tsx
│   │   │   │   ├── schedules
│   │   │   │   ├── security
│   │   │   │   │   └── page.tsx
│   │   │   │   ├── settings
│   │   │   │   │   ├── page.tsx
│   │   │   │   │   ├── school
│   │   │   │   │   │   └── page.tsx
│   │   │   │   │   └── system
│   │   │   │   │       └── page.tsx
│   │   │   │   ├── students
│   │   │   │   │   ├── [id]
│   │   │   │   │   │   └── page.tsx
│   │   │   │   │   ├── add
│   │   │   │   │   │   └── page.tsx
│   │   │   │   │   └── page.tsx
│   │   │   │   └── teachers
│   │   │   │       ├── [id]
│   │   │   │       │   └── page.tsx
│   │   │   │       ├── add
│   │   │   │       │   └── page.tsx
│   │   │   │       └── page.tsx
│   │   │   ├── community
│   │   │   │   ├── _components
│   │   │   │   │   ├── AdminForums.tsx
│   │   │   │   │   ├── AdminResources.tsx
│   │   │   │   │   ├── AdminStudyGroups.tsx
│   │   │   │   │   ├── StudentForums.tsx
│   │   │   │   │   ├── StudentResources.tsx
│   │   │   │   │   ├── StudentStudyGroups.tsx
│   │   │   │   │   ├── TeacherForums.tsx
│   │   │   │   │   ├── TeacherResources.tsx
│   │   │   │   │   └── TeacherStudyGroups.tsx
│   │   │   │   ├── forums
│   │   │   │   │   ├── [postId]
│   │   │   │   │   │   └── page.tsx
│   │   │   │   │   ├── _components
│   │   │   │   │   │   └── ForumPostDialog.tsx
│   │   │   │   │   └── page.tsx
│   │   │   │   ├── groups
│   │   │   │   │   ├── [groupId]
│   │   │   │   │   │   └── page.tsx
│   │   │   │   │   ├── create
│   │   │   │   │   │   └── page.tsx
│   │   │   │   │   └── page.tsx
│   │   │   │   ├── leaderboard
│   │   │   │   │   └── page.tsx
│   │   │   │   └── page.tsx
│   │   │   ├── layout.tsx
│   │   │   ├── learn
│   │   │   │   ├── courses
│   │   │   │   │   ├── [courseId]
│   │   │   │   │   │   └── page.tsx
│   │   │   │   │   └── page.tsx
│   │   │   │   ├── explore
│   │   │   │   │   ├── [topicId]
│   │   │   │   │   │   ├── _components
│   │   │   │   │   │   │   └── TopicDetails.tsx
│   │   │   │   │   │   └── page.tsx
│   │   │   │   │   ├── _components
│   │   │   │   │   │   └── ExplorePage.tsx
│   │   │   │   │   └── page.tsx
│   │   │   │   ├── page.tsx
│   │   │   │   ├── schedule
│   │   │   │   │   ├── _components
│   │   │   │   │   │   ├── ProfessorAndAdminSchedulePage.tsx
│   │   │   │   │   │   ├── SchedulePage.tsx
│   │   │   │   │   │   └── ScheduleWrapper.tsx
│   │   │   │   │   └── page.tsx
│   │   │   │   └── subjects
│   │   │   │       ├── [subjectId]
│   │   │   │       │   └── page.tsx
│   │   │   │       └── page.tsx
│   │   │   ├── messages
│   │   │   │   ├── _components
│   │   │   │   │   ├── ConversationList.tsx
│   │   │   │   │   └── MessagingComponents.tsx
│   │   │   │   └── page.tsx
│   │   │   ├── page.tsx
│   │   │   ├── professor
│   │   │   │   ├── ai
│   │   │   │   │   ├── assignment-generator
│   │   │   │   │   │   └── page.tsx
│   │   │   │   │   ├── assistant
│   │   │   │   │   │   └── page.tsx
│   │   │   │   │   ├── course-generator
│   │   │   │   │   │   └── page.tsx
│   │   │   │   │   ├── page.tsx
│   │   │   │   │   └── student-insights
│   │   │   │   │       └── page.tsx
│   │   │   │   ├── analytics
│   │   │   │   │   ├── attendance
│   │   │   │   │   │   └── page.tsx
│   │   │   │   │   ├── page.tsx
│   │   │   │   │   ├── performance
│   │   │   │   │   │   └── page.tsx
│   │   │   │   │   └── reports
│   │   │   │   │       └── page.tsx
│   │   │   │   ├── assignments
│   │   │   │   │   ├── create
│   │   │   │   │   │   └── page.tsx
│   │   │   │   │   ├── page.tsx
│   │   │   │   │   └── pending
│   │   │   │   │       └── page.tsx
│   │   │   │   ├── courses
│   │   │   │   │   ├── [courseId]
│   │   │   │   │   │   └── page.tsx
│   │   │   │   │   ├── _components
│   │   │   │   │   │   └── CourseCard.tsx
│   │   │   │   │   ├── add
│   │   │   │   │   │   └── page.tsx
│   │   │   │   │   └── page.tsx
│   │   │   │   ├── layout.tsx
│   │   │   │   ├── materials
│   │   │   │   │   ├── lesson-plans
│   │   │   │   │   │   └── page.tsx
│   │   │   │   │   ├── page.tsx
│   │   │   │   │   └── upload
│   │   │   │   │       └── page.tsx
│   │   │   │   ├── page.tsx
│   │   │   │   ├── schedule
│   │   │   │   │   └── page.tsx
│   │   │   │   ├── school
│   │   │   │   │   └── page.tsx
│   │   │   │   └── students
│   │   │   │       ├── _components
│   │   │   │       │   └── StudentsPage.tsx
│   │   │   │       ├── attendance
│   │   │   │       │   └── page.tsx
│   │   │   │       ├── page.tsx
│   │   │   │       └── performance
│   │   │   │           └── page.tsx
│   │   │   ├── profile
│   │   │   │   ├── _components
│   │   │   │   │   ├── EditProfile.tsx
│   │   │   │   │   ├── GuardianManagement.tsx
│   │   │   │   │   ├── LearningProgress.tsx
│   │   │   │   │   └── ProfilePage.tsx
│   │   │   │   └── page.tsx
│   │   │   ├── progress
│   │   │   │   ├── achievements
│   │   │   │   │   └── page.tsx
│   │   │   │   ├── analytics
│   │   │   │   │   └── page.tsx
│   │   │   │   ├── page.tsx
│   │   │   │   └── reports
│   │   │   │       └── page.tsx
│   │   │   ├── sessions
│   │   │   │   ├── history
│   │   │   │   │   └── page.tsx
│   │   │   │   ├── new
│   │   │   │   │   └── page.tsx
│   │   │   │   ├── page.tsx
│   │   │   │   └── practice
│   │   │   │       └── page.tsx
│   │   │   ├── settings
│   │   │   │   └── page.tsx
│   │   │   └── tutor
│   │   │       ├── chat
│   │   │       │   ├── [chatId]
│   │   │       │   │   ├── _components
│   │   │       │   │   │   ├── ChatHeader.tsx
│   │   │       │   │   │   ├── ChatInput.tsx
│   │   │       │   │   │   ├── ChatMessage.tsx
│   │   │       │   │   │   ├── FlashcardPanel.tsx
│   │   │       │   │   │   ├── MathCalculator.tsx
│   │   │       │   │   │   ├── MathTemplates.tsx
│   │   │       │   │   │   ├── WelcomeState.tsx
│   │   │       │   │   │   └── WhiteBoardPanel.tsx
│   │   │       │   │   └── page.tsx
│   │   │       │   └── page.tsx
│   │   │       ├── notes
│   │   │       │   ├── [noteId]
│   │   │       │   │   └── page.tsx
│   │   │       │   ├── _components
│   │   │       │   │   ├── NoteEditor.tsx
│   │   │       │   │   └── NotesList.tsx
│   │   │       │   ├── new
│   │   │       │   │   └── page.tsx
│   │   │       │   └── page.tsx
│   │   │       ├── page.tsx
│   │   │       ├── video
│   │   │       │   └── page.tsx
│   │   │       └── whiteboard
│   │   │           ├── [sessionId]
│   │   │           │   └── page.tsx
│   │   │           ├── _components
│   │   │           │   ├── WhiteBoardSessionPage.tsx
│   │   │           │   └── WhiteboardSessionsList.tsx
│   │   │           └── page.tsx
│   │   ├── layout.tsx
│   │   ├── onboarding
│   │   │   ├── _components
│   │   │   │   └── Onboarding.tsx
│   │   │   ├── page.tsx
│   │   │   ├── professor
│   │   │   │   └── page.tsx
│   │   │   └── school
│   │   │       ├── _components
│   │   │       │   ├── AcademicUnitsStep.tsx
│   │   │       │   ├── AnalyticsStep.tsx
│   │   │       │   ├── CoursesStep.tsx
│   │   │       │   ├── IntegrationsStep.tsx
│   │   │       │   ├── SchoolProfileStep.tsx
│   │   │       │   ├── StaffStep.tsx
│   │   │       │   └── StudentsStep.tsx
│   │   │       ├── layout.tsx
│   │   │       └── page.tsx
│   │   └── page.tsx
│   ├── favicon.ico
│   ├── globals.css
│   ├── layout.tsx
│   ├── not-found.tsx
│   └── page.tsx
├── components
│   ├── UserConditionalComponent.tsx
│   ├── global
│   │   ├── BugReportDialog.tsx
│   │   ├── DashboardHeader.tsx
│   │   ├── Logo.tsx
│   │   ├── MobileSidebar.tsx
│   │   ├── ProfessorSidebar.tsx
│   │   ├── RoleBasedOnboardingCard.tsx
│   │   ├── RoleBasedSidebar.tsx
│   │   ├── Sidebar.tsx
│   │   └── ThemeModeToggle.tsx
│   ├── language-switcher.tsx
│   └── ui
│       ├── accordion.tsx
│       ├── alert-dialog.tsx
│       ├── alert.tsx
│       ├── aspect-ratio.tsx
│       ├── avatar.tsx
│       ├── badge.tsx
│       ├── breadcrumb.tsx
│       ├── button.tsx
│       ├── calendar.tsx
│       ├── card.tsx
│       ├── carousel.tsx
│       ├── chart.tsx
│       ├── checkbox.tsx
│       ├── collapsible.tsx
│       ├── command.tsx
│       ├── context-menu.tsx
│       ├── dialog.tsx
│       ├── drawer.tsx
│       ├── dropdown-menu.tsx
│       ├── form.tsx
│       ├── hover-card.tsx
│       ├── input-otp.tsx
│       ├── input.tsx
│       ├── label.tsx
│       ├── menubar.tsx
│       ├── navigation-menu.tsx
│       ├── pagination.tsx
│       ├── popover.tsx
│       ├── progress.tsx
│       ├── radio-group.tsx
│       ├── resizable.tsx
│       ├── scroll-area.tsx
│       ├── select.tsx
│       ├── separator.tsx
│       ├── sheet.tsx
│       ├── skeleton.tsx
│       ├── slider.tsx
│       ├── sonner.tsx
│       ├── steps.tsx
│       ├── switch.tsx
│       ├── table.tsx
│       ├── tabs.tsx
│       ├── textarea.tsx
│       ├── toggle-group.tsx
│       ├── toggle.tsx
│       └── tooltip.tsx
├── hooks
│   ├── use-mobile.ts
│   ├── use-toast.ts
│   └── useAISuggestions.ts
├── i18n
│   ├── client.ts
│   ├── config.ts
│   └── dictionaries
│       ├── ar.ts
│       ├── en.ts
│       └── fr.ts
├── lib
│   ├── config.ts
│   └── utils.ts
├── middleware.ts
├── providers
│   ├── AuthProvider.tsx
│   ├── ChatToolsContext.tsx
│   ├── CommunityWebSocketProvider.tsx
│   ├── MessagingContext.tsx
│   └── index.tsx
├── services
│   ├── AdminDashboardService.ts
│   ├── BugReportService.ts
│   ├── ChatService.ts
│   ├── CommunityService.ts
│   ├── CoursesService.ts
│   ├── DashboardService.ts
│   ├── ExploreService.ts
│   ├── FileService.ts
│   ├── IntelligentNoteService.ts
│   ├── LearningService.ts
│   ├── MessagingService.ts
│   ├── ProfessorAIService.ts
│   ├── ProfessorAnalyticsService.ts
│   ├── ProfessorMaterialsService.ts
│   ├── ProfessorSchoolService.ts
│   ├── ProfessorService.ts
│   ├── ProfessorStudentService.ts
│   ├── ProfileService.ts
│   ├── ScheduleService.ts
│   ├── SchoolOnboardingService.ts
│   ├── SubjectsService.ts
│   ├── TutorService.ts
│   └── WhiteboardService.ts
└── types
    ├── dashboard.ts
    └── user.ts

127 directories, 255 files

---
## Startup Context

**EdTech SaaS Platform for AI-Powered Tutoring**

We are building an innovative EdTech startup SaaS designed to revolutionize education by **integrating AI into the tutoring process**. This platform targets students individually, as well as through schools, and provides operations and insights for **professors, administrators, and parents**.

### Key Features:
1. **AI-Powered Student Alignment**:
   - AI helps students align with their educational goals, assist them with learning, and tailor their study experience to their unique needs.
   - Students are connected to personalized AI tutors that help them in specific subjects, fostering a deeper understanding and improving learning outcomes.

2. **Real-Time Feedback & Recommendations**:
   - Professors and administrators can monitor student interactions with the AI tutor. The system provides data-driven insights into each student's strengths and areas for improvement.
   - AI suggests specific areas for students to focus on in **physical school settings**, helping bridge the gap between digital and physical learning.

3. **Professors & Administrators’ Insight**:
   - Professors can analyze detailed reports of student progress and receive suggestions from AI on how to better support each student.
   - Administrators gain insights into overall student performance trends, helping them improve educational outcomes at a school-wide level.

4. **Parental Engagement**:
   - Parents receive personalized updates and suggestions from the AI system about their child's learning journey, giving them actionable insights to support their child’s academic progress.

### How it Works:
- **For Students**: The AI tutor learns from each interaction, continuously improving the way it supports the student.
- **For Professors & Admin**: The AI collects data from student interactions and uses it to generate reports, offering professors specific guidance on areas that require attention.
- **For Parents**: The platform gives parents a transparent view of their child’s progress, ensuring they can actively participate in their educational journey.

With this model, the goal is to **level up education**, making learning more personalized, efficient, and accessible to all stakeholders involved.
